<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Simple Web App</title>
    </head>
    <body>
        <h1>Welcome to the web app!</h1>

        <input type="text" id="task-input" placeholder="Type task here">
        <button id="post-task">Post task</button>
        <p id="loading-message"></p>
        <p id="response-message"></p>

        <button id="show-tasks">Show Tasks</button>
        <p id="tasks-loading"></p>
        <p id="error-message"></p>

        <script>
            const postButton = document.getElementById("post-task");
            const taskButton = document.getElementById("show-tasks");
            const postedLoading = document.getElementById("loading-message");
            const postedMessage = document.getElementById("response-message");
            const tasksMessage = document.getElementById("tasks-loading");

            async function addTask() {
                const task = document.getElementById("task-input").value;
                
                try {
                    const response = await fetch('http://localhost:5000/tasks', {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({"task": task})
                    })

                    if (!response.ok) {
                        throw new Error('This was an error.')
                    }

                    const data = await response.json();
                    postedMessage.innerHTML = data.message;
                } catch (error) {
                    postedMessage.innerHTML = "Error posting task. Please try again."
                    console.error("Error:", error);
                }
            }

            postButton.addEventListener("click", () => {
                postedLoading.innerHTML = "Waiting for task to post...";
                addTask();
            });

            async function fetchTasks() {
                try {
                    const response = await fetch('http://localhost:5000/tasks');

                    if (!response.ok) {
                        throw new Error('This was an error.')
                    }

                    const data = await response.json();

                    document.getElementById('message').innerHTML = `Message from the backend: ${data.message}`;
                } catch (error) {
                    document.getElementById('error-message').innerHTML = "Error fetching tasks from the backend.";
                    console.error("Error:", error);
                }
            }

            taskButton.addEventListener("click", () => {
                tasksMessage.innerHTML = "Retrieving tasks...";
                fetchTasks();
            });
        </script>
    </body>
</html>